
function getApiBase(): string {
  const raw = String(import.meta.env.VITE_API_URL || "").trim();
  return raw.replace(/\/+$/, "");
}

function isAbsolute(url: string) {
  return /^https?:\/\//i.test(url);
}

export function absUrl(input: string | null | undefined): string {
  const v = String(input || "").trim();
  if (!v) return "";

  // ya absoluta â†’ no tocar
  if (isAbsolute(v)) return v;

  const API = getApiBase();

  // uploads deben apuntar al backend
  if (API && (v.startsWith("/uploads/") || v.startsWith("/api/uploads/"))) {
    return API + v;
  }

  // si empieza con / pero no es uploads, dejar relativo
  if (v.startsWith("/")) return v;

  return v;
}
